---
layout: post
title: "ステータス変更履歴機能の設計・実装・バグ発見"
---

業務システムのステータス変更が「誰が・いつ・なぜ」変更したのかを追跡できる機能を実装した。

## 課題

- 既存のステータス変更履歴テーブルのデータ信頼性が低かった
- API経由でステータスを変更すると、変更者の区分が一律「システム」になるバグを発見
- 「ヒューマンエラーかシステムエラーか」を識別するためのカラムが正しく機能していなかった

## やったこと

- 既存のデータフローを解析し、問題点をドキュメントにまとめた
- DBカラムの追加（operator_id）とAPI修正
- 変更履歴を閲覧するモーダルUIを3パターン作成し、レビューを依頼
- アコーディオン式の履歴表示（デフォルトは閉じた状態）を採用
- Dev環境へのマイグレーション実行とテスト

## UI案

- パターン1: 変更履歴をタイムライン表示
- パターン2: テーブル形式で一覧表示
- パターン3: コンパクトなログ形式

## 学び

- 「同じ問題が起きた時に原因がわかるように」だけでなく「同じ問題が起きないように」する設計が大事
- 既存コードの謎仕様は、疑問に思ったらすぐ声を上げたほうがいい
